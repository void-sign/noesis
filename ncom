#!/usr/bin/env fish

# ncom - Noesis Command
# A simplified command wrapper for common Noesis operations
# Usage: ./ncom <command> or ./ncom -<flag>

# Get the script directory
set SCRIPT_DIR (dirname (status -f))

# Define colors for better readability
set GREEN (set_color green)
set BLUE (set_color blue)
set YELLOW (set_color yellow)
set RED (set_color red)
set PINK (set_color ff5fd7) # Bright pink
set NC (set_color normal)

# Parse single-letter flags
if test (count $argv) -gt 0; and string match -q -- "-*" $argv[1]
    set flag (string sub -s 2 -- $argv[1])
    
    switch $flag
        case "s"
            # Save structure state
            fish $SCRIPT_DIR/noesis.fish save
            exit 0
        case "c"
            # Continue/restore structure state
            fish $SCRIPT_DIR/noesis.fish continue
            exit 0
        case "b"
            # Build
            fish $SCRIPT_DIR/noesis.fish build
            exit 0
        case "r"
            # Run
            fish $SCRIPT_DIR/noesis.fish run
            exit 0
        case "t" 
            # Test
            fish $SCRIPT_DIR/noesis.fish test
            exit 0
        case "h"
            # Show help
            echo $YELLOW"ncom"$NC" - Noesis Command Shortcut"
            echo
            echo $YELLOW"Usage:"$NC
            echo "  ./ncom <command>"
            echo "  ./ncom -<flag>"
            echo
            echo $YELLOW"Commands:"$NC
            echo "  "$GREEN"save"$NC"         - Save current project structure state"
            echo "  "$GREEN"continue"$NC"     - Restore latest saved structure state"
            echo "  "$GREEN"build"$NC"        - Build the Noesis core"
            echo "  "$GREEN"run"$NC"          - Run the Noesis core"
            echo "  "$GREEN"test"$NC"         - Run all tests"
            echo
            echo $YELLOW"Flags:"$NC
            echo "  "$GREEN"-s"$NC"           - Save structure state (shorthand)"
            echo "  "$GREEN"-c"$NC"           - Continue/restore structure (shorthand)"
            echo "  "$GREEN"-b"$NC"           - Build (shorthand)"
            echo "  "$GREEN"-r"$NC"           - Run (shorthand)"
            echo "  "$GREEN"-t"$NC"           - Test (shorthand)"
            echo "  "$GREEN"-h"$NC"           - Show this help"
            exit 0
        case "*"
            echo $RED"Error: Unknown flag '-$flag'"$NC
            echo "Use '$GREEN-h$NC' for help"
            exit 1
    end
end

# Parse commands
if test (count $argv) -gt 0
    set command $argv[1]
    
    switch $command
        case "save"
            fish $SCRIPT_DIR/noesis.fish save
        case "continue"
            fish $SCRIPT_DIR/noesis.fish continue
        case "build"
            fish $SCRIPT_DIR/noesis.fish build
        case "run"
            fish $SCRIPT_DIR/noesis.fish run
        case "test"
            fish $SCRIPT_DIR/noesis.fish test
        case "help"
            # Show help (same as -h)
            echo $YELLOW"ncom"$NC" - Noesis Command Shortcut"
            echo
            echo $YELLOW"Usage:"$NC
            echo "  ./ncom <command>"
            echo "  ./ncom -<flag>"
            echo
            echo $YELLOW"Commands:"$NC
            echo "  "$GREEN"save"$NC"         - Save current project structure state"
            echo "  "$GREEN"continue"$NC"     - Restore latest saved structure state"
            echo "  "$GREEN"build"$NC"        - Build the Noesis core"
            echo "  "$GREEN"run"$NC"          - Run the Noesis core"
            echo "  "$GREEN"test"$NC"         - Run all tests"
            echo
            echo $YELLOW"Flags:"$NC
            echo "  "$GREEN"-s"$NC"           - Save structure state (shorthand)"
            echo "  "$GREEN"-c"$NC"           - Continue/restore structure (shorthand)"
            echo "  "$GREEN"-b"$NC"           - Build (shorthand)"
            echo "  "$GREEN"-r"$NC"           - Run (shorthand)"
            echo "  "$GREEN"-t"$NC"           - Test (shorthand)"
            echo "  "$GREEN"-h"$NC"           - Show this help"
        case "*"
            echo $RED"Error: Unknown command '$command'"$NC
            echo "Use 'ncom help' or 'ncom -h' for help"
            exit 1
    end
else
    # No arguments, show help
    echo $YELLOW"ncom"$NC" - Noesis Command Shortcut"
    echo
    echo $YELLOW"Usage:"$NC
    echo "  ./ncom <command>"
    echo "  ./ncom -<flag>"
    echo
    echo $YELLOW"Commands:"$NC
    echo "  "$GREEN"save"$NC"         - Save current project structure state"
    echo "  "$GREEN"continue"$NC"     - Restore latest saved structure state"
    echo "  "$GREEN"build"$NC"        - Build the Noesis core"
    echo "  "$GREEN"run"$NC"          - Run the Noesis core"
    echo "  "$GREEN"test"$NC"         - Run all tests"
    echo
    echo $YELLOW"Flags:"$NC
    echo "  "$GREEN"-s"$NC"           - Save structure state (shorthand)"
    echo "  "$GREEN"-c"$NC"           - Continue/restore structure (shorthand)"
    echo "  "$GREEN"-b"$NC"           - Build (shorthand)"
    echo "  "$GREEN"-r"$NC"           - Run (shorthand)"
    echo "  "$GREEN"-t"$NC"           - Test (shorthand)"
    echo "  "$GREEN"-h"$NC"           - Show this help"
end
